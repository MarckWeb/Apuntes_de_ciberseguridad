## Comandos Intermedios

Estos comandos son útiles para la administración del sistema y manipulación de archivos.

- __printenv (Print Environment)__ -. Imprime todas o algunas de las variables de entorno.  

```bash
printenv
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ printenv

-----------------Salida--------------------
COLORFGBG=15;0
COLORTERM=truecolor
COMMAND_NOT_FOUND_INSTALL_PROMPT=1
DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
.......
```
- __whoami (Who Am I)__ -.  Muestra el nombre del usuario actual.  

```bash
whoami
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ whoami

-----------------Salida--------------------
marck
```

- __who (Who)__ -. Muestra información sobre los usuarios que están actualmente conectados.  

```bash
who
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ who

-----------------Salida--------------------
marck    tty7         2024-04-05 00:06 (:0)
```

- __passwd (Password)__ -. Cambia la contraseña de un usuario.  

```bash
passwd
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ passwd

-----------------Salida--------------------
Changing password for marck.
Current password: 
```

- __ping (Ping)__ -. Comprueba la conectividad de red.  

```bash
ping direccion_ip_o_url
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ ping google.com

-----------------Salida--------------------
PING google.com (172.217.10.46) 56(84) bytes of data.
```

- __traceroute (Traceroute)__ -. Rastrea la ruta que siguen los paquetes para llegar a un host.  

```bash
traceroute direccion_ip_o_url
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ traceroute google.com

-----------------Salida--------------------
traceroute to google.com (142.250.184.174), 30 hops max, 60 byte packets
1  mygpon.ip (192.168.0.1)  9.059 ms  8.984 ms  9.251 ms
.......
```

- __uname (Unix Name)__ -. Muestra información del sistema.  

```bash
uname -a
```

```bash
# Ejemplo
┌──(marck㉿kali)-[~]
└─$ uname -a

-----------------Salida--------------------
Linux kali 5.10.0-kali3-amd64 #1 SMP Debian 5.10.13-1kali1 (2021-02-08) x86_64 GNU/Linux
```

- __nano o vi (Text Editors)__ -. Abre un archivo en el editor de texto nano o vi.

```bash
nano nombre_del_archivo_a_editar
```

```bash
vi nombre_del_archivo_a_editar
```
Para salir de VI  solo basta con colocar :q en el modo normal de VI (pulsando ESC se consigue el modo normal), de esta manera podrás salir sin problema. En el modo normal también puedes combinar comandos como por ejemplo :wq, guarda (w) y cierra el programa (q). VI ejecuta los comandos de izquierda a derecha, es importante esto.


- __head (head)__ -. El comando head obtiene las n-primeras líneas de un archivo. Como opciones se puede utilizar:

    - c N: obtiene los N primeros caracteres del contenido del archivo.
    - n N: obtiene los N primeras líneas del contenido del archivo (por defecto head muestra las 10 primeras líneas).

```bash
head opciones archivo.txt
```

- __tail (tail)__ -. El comando tail obtiene las n-últimas líneas del contenido de un archivo. Las opciones más destacables de este comando son:

    - c N: obtiene los N últimos caracteres del contenido del archivo.
    - n N: obtiene las N últimas líneas del contenido del archivo.
    - f: muestra las últimas líneas del contenido del fichero, y deja el comando a espera para ir imprimiendo las nuevas líneas que se vayan escribiendo en dicho fichero.

```bash
tail opciones archivo.txt
```

_**ejemplos mas usados**_

- `head /etc/passwd` -.Las primeras diez líneas del archivo `/etc/passwd`.

- `head -3 /etc/group`-. Las primeras tres líneas del archivo `/etc/group`.

- `head -n 3 /etc/group`-. Las primeras tres líneas del archivo `/etc/group`.

- `help | head`-. Las primeras diez líneas de la salida del comando `help` redirigidas por la barra vertical.

- `tail /etc/group`-. Las últimas diez líneas del archivo `/etc/group`.

- `tail -5 /etc/passwd`-. Las últimas cinco líneas del archivo `/etc/passwd`.

- `tail -n 5 /etc/passwd`-. Las últimas cinco líneas del archivo `/etc/passwd`.

- `help | tail`-. Las últimas diez líneas de la salida del comando `help` redirigidas por la barra vertical.


- __chmod (Change Mode)__ -. Cambia los permisos de un archivo o directorio (-rw-rwx---). 

```bash
chmod 755 nombre_del_archivo.
```
Otra forma de escribir es asignando + o - para agregar permiso, o para eliminarlo. Después ingresamos uno o más símbolos de permiso (r, w, x).

```bash
chmod u+rw filename # usuario puede leer, escribir
chmod u-r filename # usuario solo puede leer
```

- __chown (Change Owner)__ -. Cambia el propietario de un archivo o directorio. Los : puntos separan usuario y grupo.

```bash
chown usuario:grupo nombre_del_archivo
```
para que un archivo pertenezca a un nuevo usuario se coloca

```bash
chown nuevo_usuario archivo.txt
```

cambiar el usuario y el grupo del archivo:

```bash
chown nuevo_usuario:grupo_usuario archivo.txt
```
Cambiar grupo de un directorio:

```bash
chown -R :grupo_usuario nombre_directorio
```

- __grep (global regular expression print )__ -. Busca patrones dentro de archivos.

```bash
grep "patrón" nombre_del_archivo
```

```bash
# buscar un texto o patron en dos archivo
grep "texto" archivo1.txt archivo2.txt
```

```bash
# buscar un texto o patron en todos los .txt
grep "texto" *.txt
```

```bash
# buscar un texto o patron en todo
# este directorio
grep -r "texto" nombre_directorio/
```

```bash
# ignora mayus o minus del patron
grep -i "texto" archivo.txt
```

```bash
# buscar el patro dentro de resultado de whois
whois dominio.com | grep '@dominio.com'
```

- __which (cual)__ -. Se utiliza para mostrar la ruta completa del comando en cuestión, es decir donde esta almacenado

```bash
┌──(marck㉿kali)-[~]
└─$ which spiderfoot 

----------Salida-----------
/usr/bin/spiderfoot

# 2-. Ejemplo
┌──(marck㉿kali)-[~]
└─$ which dig  

----------Salida-----------
/usr/bin/dig

# tambien se pude utilizar otro comando para buscar 

┌──(marck㉿kali)-[~]
└─$ whereis ls 

----------Salida-----------
ls: /bin/ls /usr/share/man/man1/ls.1.gz   
```

- __type (Tipo)__ -. Parecido a wich pero tambien puede utilizarse para determinar la información acerca de varios comandoso

```bash
┌──(marck㉿kali)-[~]
└─$ type which                                               

----------Salida-----------
which is a shell builtin

# 2-. Ejemplo
┌──(marck㉿kali)-[~]
└─$ type ls 

----------Salida-----------
ls is an alias for ls --color=auto
                                                                                                  
┌──(marck㉿kali)-[~]
└─$ type chmod 

----------Salida-----------
chmod is /usr/bin/chmod
```
Usando la opción -a, el comando type también puede revelar la ruta de otro comando:

```bash
┌──(marck㉿kali)-[~]
└─$ type -a echo
echo is a shell builtin
echo is /usr/bin/echo
echo is /bin/echo
```

- __alias (Alias)__ -. se crean para colocar en un comando una secuencia de comandos y  parametros. Solo existen mientras la shell esta abierta

```bash
┌──(marck㉿kali)-[~]
└─$ alias listar='ls -l-a'                                             

----------Salida-----------
alias guardado si no sale nada en la terminal

# Usamos el alias
┌──(marck㉿kali)-[~]
└─$ listar

----------Salida-----------
drwxr-xr-x 1 sysadmin sysadmin   20 Jun 28 14:05 .                              
drwxr-xr-x 1 root     root       22 Mar 14  2016 ..                                                    
drwx------ 2 sysadmin sysadmin   34 Jun 28 14:05 .cache                                               
drwxr-xr-x 2 sysadmin sysadmin    6 Mar 14  2016 Documents
```

- __gzip (gzip)__ -. comprime los archivos en formato zip

```bash
┌──(marck㉿kali)-[~]
└─$ gzip importante.txt  

----------Salida-----------
si haces ls saldra un archivo con extencion gz
```
- __gunzip (gunzip)__ descomprime los archivos en formato zip.

```bash
┌──(marck㉿kali)-[~]
└─$ gunzip importante.txt

----------Salida-----------
si haces ls desaparecera el archivo con extencion gz
```
- __tar (tar)__ descomprime los archivos en formato zip.
El comando tar se utiliza para combinar varios archivos en un solo archivo. Por defecto no comprime los datos.

La opción -c le indica al comando tar que cree un archivo tar. La opción -v significa "verbose", que le indica al comando tar para muestre lo que está haciendo. La opción -f se utiliza para especificar el nombre del archivo tar

```bash
# Creamso un directorio mkdir myfolio
# comprimimos el directorio udev en myfolio/udev.tar, aunque la extencion no es obligado
┌──(marck㉿kali)-[~]
└─$ tar –cvf myfolio/udev.tar /etc/udev

----------Salida-----------
tar: Removing leading `/' 
```

```bash
# Creamso un directorio mkdir myfolio
# comprimimos el directorio udev en myfolio/udev.tar, aunque la extencion no es obligado
┌──(marck㉿kali)-[~]
└─$ tar –cvf myfolio/udev.tar /etc/udev

----------Salida-----------
tar: Removing leading `/' 
```

Muestra el contenido del archivo tar (t = lista el contenido, v = verbose, f =nombre del archivo)

```bash
# Creamso un directorio mkdir myfolio
# comprimimos el directorio udev en myfolio/udev.tar, aunque la extencion no es obligado
┌──(marck㉿kali)-[~]
└─$ tar -tvf myfolio/udev.tar

----------Salida-----------
mostrara todos los archivos dentro del directorio comprimido
```

Para crear un archivo tar comprimido, utiliza la opción -z

```bash
# La opción -z hace uso de la utilidad gzip para realizar la compresión.
┌──(marck㉿kali)-[~]
└─$ tar –zcvf myfolio/udev.tar.gz /etc/udev

----------Salida-----------
mostrara todos los archivos dentro del directorio comprimido
```
Extraer el contenido de un archivo. Los datos se restauran en el directorio actual por defecto:

```bash
┌──(marck㉿kali)-[~]
└─$ tar –xvf udev.tar.gz

----------Salida-----------
ls
ls etc
ls etc/udev
ls etc/udev/rules.d
```

- __find (find)__ -. se utiliza para buscar archivos en el sistema de archivo

```bash
# find [start directory] [search option] [search criteria] [result option]
┌──(marck㉿kali)-[~]
└─$ find /etc -name hosts   

----------Salida-----------
find: `/etc/lvm/backup': Permission denied
find: `/etc/lvm/archive': Permission denied                           
/etc/hosts
find: `/etc/ntp/crypto': Permission denied
find: `/etc/polkit-l/localauthority': Permission denied   
find: `/etc/sudoers.d': Permission denied  
find: `/etc/sssd': Permission denied 
/etc/avahi/hosts

# Filtrar solo a los que se tiene permiso de acceso
┌──(marck㉿kali)-[~]
└─$ find /etc -name hosts 2> errors.txt   

----------Salida-----------
/etc/hosts 
/etc/avahi.hosts 

# Hay veces no hay proposito de guardar los errores
# entonves se nevia a un archivo de basura
┌──(marck㉿kali)-[~]
└─$ find /etc -name hosts 2> /dev/null    

----------Salida-----------
/etc/hosts 
/etc/avahi.hosts

# Mostrando los Detalles del Archivo

┌──(marck㉿kali)-[~]
└─$ find /etc -name hosts -ls 2> /dev/null
# el comando indica buscar dir host en etc, lista los archivos y
# filtra solo los que se tiene permiso de acceso, ya que lso 
# errores lo envia al archivo basura    

----------Salida-----------
41   4 -rw-r--r--  1 root  root 158 Jan 12 2010 /etc/hosts
6549 4 -rw-r--r--  1 root  root 1130 Jul 19 2011 /etc/avahi/hosts 
```





